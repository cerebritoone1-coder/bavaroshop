{% extends "base.html" %}

{% block content %}

<div class="max-w-6xl mx-auto px-6 py-16">

    <div class="grid md:grid-cols-2 gap-14 bg-white p-10 rounded-3xl shadow-2xl">

        <!-- Imagen -->
       <div style="display:flex; gap:20px;">

    <!-- Imagen principal -->
    <div>
        <img id="mainImage"
             src="{{ product.image.url }}"
             style="width:400px; border-radius:12px;">
    </div>

    <!-- Miniaturas -->
    <div class="flex flex-col lg:flex-row gap-6">

    <!-- IMAGEN PRINCIPAL -->
    <div class="flex-1 flex justify-center items-center bg-gray-50 p-4 rounded-xl">

        {% if product.image %}
            <img id="mainImage"
                 src="{{ product.image.url }}"
                 class="max-h-64 sm:max-h-96 w-auto object-contain transition duration-300">
        {% endif %}

    </div>

    <!-- MINIATURAS -->
    <div class="flex lg:flex-col gap-3 justify-center">

        <!-- Imagen principal como miniatura -->
        <img src="{{ product.image.url }}"
             onclick="changeImage(this)"
             class="w-16 sm:w-20 cursor-pointer rounded-lg border hover:scale-105 transition">

        {% for img in images %}
            <img src="{{ img.image.url }}"
                 onclick="changeImage(this)"
                 class="w-16 sm:w-20 cursor-pointer rounded-lg border hover:scale-105 transition">
        {% endfor %}

    </div>

</div>

<script>
function changeImage(element) {
    document.getElementById("mainImage").src = element.src;
}
</script>


        <!-- Informaci√≥n -->
        <div class="flex flex-col">

            <h1 class="text-4xl font-bold text-gray-900 mb-4">
                {{ product.name }}
            </h1>

            <p class="text-gray-600 leading-relaxed mb-6">
                {{ product.description }}
            </p>

            <div class="mb-8">
                <span class="text-3xl font-bold text-green-600">
                    RD$ {{ product.price|floatformat:2 }}
                </span>
            </div>

            <form method="post" action="{% url 'agregar_al_carrito' product.id %}" id="cart-form">
                {% csrf_token %}

                {% if sizes %}

                <div class="mb-6">
                    <p class="text-sm font-semibold text-gray-800 mb-3">
                        Selecciona tu talla
                    </p>

                    <div class="flex gap-2 mb-6 flex-wrap">
                        {% for size in sizes %}
                        <button type="button"
                                class="size-btn border border-blue-500 text-blue-600 
                                       text-xs font-semibold 
                                       px-3 py-1 
                                       rounded-md 
                                       hover:bg-blue-500 hover:text-white 
                                       transition-all duration-200"
                                data-size="{{ size.size }}"
                                data-stock="{{ size.stock }}"
                                {% if size.stock == 0 %} disabled {% endif %}>

                            <span class="block font-bold">
                                {{ size.size }}
                            </span>

                            {% if size.stock > 0 %}
                                <span class="block text-[9px] text-gray-500">
                                    {{ size.stock }} disp.
                                </span>
                            {% else %}
                                <span class="block text-[9px] text-red-500">
                                    Agotado
                                </span>
                            {% endif %}
                        </button>
                        {% endfor %}
                    </div>

                    <p id="size-error" class="text-red-500 text-sm mt-3 hidden">
                        Debes elegir una talla antes de continuar.
                    </p>

                    <input type="hidden" name="size" id="selected-size">
                </div>

                {% endif %}

                <!-- Bot√≥n a√±adir -->
                <button type="submit"
                        id="add-to-cart-btn"
                        class="w-full bg-green-600 text-white py-4 rounded-xl font-semibold text-lg shadow-md hover:bg-green-700 transition">
                    A√±adir al carrito
                </button>

                <!-- Volver -->
                <a href="{% url 'tienda' %}"
                   class="block text-center mt-4 w-full bg-gray-700 text-white py-3 rounded-xl hover:bg-gray-800 transition">
                    Volver a la tienda
                </a>

            </form>

            <!-- Bloque confianza -->
            <div class="mt-10 border-t pt-6 text-sm text-gray-500 space-y-2">
                <p>‚úî Env√≠o r√°pido en 24-48 horas</p>
                <p>‚úî Pago 100% seguro</p>
                <p>‚úî Garant√≠a de satisfacci√≥n</p>
            </div>

        </div>

    </div>

    <!-- üî• PRODUCTOS SIMILARES -->
    {% if related_products %}
    <div class="mt-20">

        <h2 class="text-3xl font-bold text-white mb-10 text-center">
            Productos similares
        </h2>

        <div class="grid md:grid-cols-4 gap-8">

            {% for item in related_products %}
            <div class="bg-white rounded-2xl shadow-xl p-6 hover:shadow-2xl transition duration-300">

                {% if item.image %}
                <img src="{{ item.image.url }}"
                     class="w-full h-48 object-contain rounded-lg mb-4">
                {% endif %}

                <h3 class="font-semibold text-gray-800 mb-2">
                    {{ item.name }}
                </h3>

                <p class="text-green-600 font-bold mb-4">
                    RD$ {{ item.price|floatformat:2 }}
                </p>

                <a href="{% url 'product_detail' item.slug %}"
                   class="block text-center bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
                    Ver producto
                </a>

            </div>
            {% endfor %}

        </div>

    </div>
    {% endif %}

</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

    const sizeButtons = document.querySelectorAll(".size-btn");
    const selectedInput = document.getElementById("selected-size");
    const addToCartBtn = document.getElementById("add-to-cart-btn");
    const sizeError = document.getElementById("size-error");

    sizeButtons.forEach(button => {
        button.addEventListener("click", function() {

            sizeButtons.forEach(btn => {
                btn.classList.remove("bg-blue-600", "text-white", "shadow-lg");
                btn.classList.add("border-blue-500", "text-blue-600");
            });

            this.classList.remove("border-blue-500", "text-blue-600");
            this.classList.add("bg-blue-600", "text-white", "shadow-lg");

            selectedInput.value = this.dataset.size;

            if (sizeError) {
                sizeError.classList.add("hidden");
            }
        });
    });

    if (addToCartBtn) {
        addToCartBtn.addEventListener("click", function(e) {

            if (sizeButtons.length > 0 && !selectedInput.value) {
                e.preventDefault();
                if (sizeError) {
                    sizeError.classList.remove("hidden");
                }
            }

        });
    }

});
</script>

{% endblock %}
